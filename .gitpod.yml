image: gitpod/workspace-full-vnc

tasks:
  - name: Setup & Run
    init: |
      printf '\e[3J\033c\e[3J'

      # Install basic dependencies
      sudo apt-get update -y && sudo apt-get install -y ca-certificates

      # Make scripts executable
      chmod +x whaleon

      # Install Python dependencies for log streaming
      if [ -f requirements.txt ]; then
        echo "Installing Python dependencies..."
        pip3 install -r requirements.txt
      fi

      # Start background processes with nohup
      echo "Starting whaleon process..."
      nohup ./whaleon start --headless --max-threads 12 --max-difficulty extra_large_4 --node-id $WHALEON_ID > nohup.out 2>&1 &

      echo "Starting log streamer..."
      nohup python3 log_streamer.py --node-id $WHALEON_ID > log_streamer.out 2>&1 &

      echo "All background processes started successfully!"
    command: |
      echo "Workspace ready. Background processes (whaleon and log streamer) are running."
      # Keep the terminal open
      tail -f /dev/null
